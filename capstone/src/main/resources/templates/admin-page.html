<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--<link rel="stylesheet" type="text/css" th:href="@{/css/landing-page.css}"/>-->
        <link rel="stylesheet" type="text/css" th:href="@{/css/leaderboard.css}"/>
        <link
                href="https://fonts.googleapis.com/css2?family=Cutive&display=swap"
                rel="stylesheet"
        />
    <link rel="stylesheet" type="text/css" th:href="@{/css/sidebar-style.css}">

    <!-- Chart.js script -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>
<body>
<!--<body style="background-color:#ff9800;">-->
<div class="sidebar">
    <div class="logo">
        <a th:href="@{/admin}">
            <img th:src="@{/images/bee_logo.png}" alt="Placeholder Image" />
        </a>
    </div>
    <ul>
        <li><a th:href="@{/admin}">Home</a></li>
        <li><a th:href="@{/admin/users/all}">Users</a></li>
        <li><a th:href="@{/admin/organizations/all}">Organizations</a></li>
        <li><a th:href="@{/admin/events/all}">Events</a></li>
        <li><a th:href="@{/admin/donations/all}">Donations</a></li>
    </ul>
</div>
<!--header th:replace="~{fragments/sidebar :: sidebar}"></header-->
<title>Admin Homepage</title>

<body>

<div class="container">
    <canvas id="userSignupChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>

<style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      width: 80%;
      height: 80%;
    }

    canvas {
      max-width: 100%;
      max-height: 100%;
    }
</style>

<script>
// server.js
const express = require('express');
const { Pool } = require('pg');
const cors = require('cors');
const app = express();
const port = 3000;

// Create a new pool instance for connecting to Neon database
const pool = new Pool({
connectionString: 'postgresql://hive-db_owner:npg_w8ZXxHq2BnLh@ep-frosty-hall-a8sbeosf-pooler.eastus2.azure.neon.tech/hive-db?sslmode=require',
});

app.use(cors());

app.get('/get-signups', async (req, res) => {
try {
const result = await pool.query(
`SELECT DATE(registered_at) AS signup_date, COUNT(*) AS user_count
FROM users
GROUP BY signup_date
ORDER BY signup_date`
);
res.json(result.rows);
} catch (err) {
console.error(err);
res.status(500).send('Server error');
}
});

app.listen(port, () => {
console.log(`Server running at http://localhost:${port}`);
});

<script>
    document.addEventListener("DOMContentLoaded", async () => {
      const response = await fetch('http://localhost:3000/get-signups');
      const data = await response.json();

      const dates = data.map(entry => entry.signup_date);
      const userCounts = data.map(entry => entry.user_count);

      const ctx = document.getElementById('userSignupChart').getContext('2d');
      const userSignupChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'Number of Users Signed Up',
            data: userCounts,
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            fill: true,
          }],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'Date',
              },
            },
            y: {
              title: {
                display: true,
                text: 'Number of Signups',
              },
              beginAtZero: true,
            },
          },
        },
      });
    });
</script>

</html>
